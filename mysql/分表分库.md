# 分库分表
随着系统运行，请求并发量太大，数据库的数据量太大，单表记录太多，表字段太多，个别字段太长都会影响sql性能，使数据库成为性能瓶颈，以上每个场景都可以利用分库或者分表解决

# 划分种类
## 水平划分
+ 分库:当系统并发量很大，单库的连接不够用时可以利用水平分库平摊请求。建立多个数据库，数据库的结构是一样的，只是保存的数据不同，将数据分布在多个库保存，这样不同的请求可以定位到不同库
+ 分表:如果一个表的记录数很多，比如订单表，某些查询语句会扫描大量记录导致查询很慢，此时可以水平分表，使用hash、rang等算法将数据保存在不同表，缩小的单表记录的数量
## 垂直划分
+ 分库:系统很庞大时有各种业务线，每个业务线之间的联系可能不那么紧密，为了减少库大小，可以根据业务垂直分库，比如账户服务，订单服务，商户信息保存在三个库。
+ 分表:某些表记录数可能不是很多，但是某些字段很大，比如保存了一些文件，这些大字段会导致查询跨页，也使得缓存没什么作用，产生大量IO。此时需要根据字段特点垂直分表，将这些大字段用单独的表保存

# 分库后的问题
+ 分库以后就属于分布式数据库了，使用事务就必须使用分布式事务了，难度和代价都很高
+ 垂直分库以后很难使用join操作，因为很可能需要夸库join，解决需要分场景
    - 进了避免jion操作，分库前期就添加一些通用的荣誉字段
    - 如果两个表都很小，可以在代码中join
    - 如果一个大表一个小表，可以先将小表加载到内存，然后查询大表在代码中连接
    - 如果两个表都很大，先进行主键的join,根据join结果查询

# 读写分离
+ 在读多写少的业务场景，单个库可能无法承受大量的读请求，此时可以采用读写分离模式降低数据库的读压力
+ 读写分离利用mysql的主从结构实现，我们可以将mysql部署为主从模式，主节点专用于写数据，从节点不断从主节点同步数据，支持客户端的读请求
+ 读写分离的核心就在于主从节点数据的同步，底层步骤是主节点使用binlog记录所有insert,update操作，当binlog变动时主节点会通知所有从节点，并将更新指令推送到从节点，从节点也是先将指令记录在relay log日志，然后同步数据
+ 读写分离的缺点是从节点在同步数据过程中可能因为网络波动有段时间的延迟，如果业务对这个延迟不敏感就无所谓。如果某些业务无法接受这个延迟，可以配置这些业务直接从主节点读取数据。同一个seesion修改数据以后也需要直接从主节点读取数据，保证事务机制
+ 读写分离在代码层面可以利用AOP实现，也可以利用一些三方框架实现